{% extends 'base.html' %}

{% block title %}CPE Recommendations - {{ certification.name }} - CPE Management Platform{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-1">
                    <i class="fas fa-lightbulb text-warning me-2"></i>
                    CPE Recommendations
                </h2>
                <p class="text-muted mb-0">
                    Real-world activities to help you earn CPEs for {{ certification.name }} ({{ certification.authority }})
                </p>
            </div>

            <!-- Add Recommendation Button -->
            <a href="{{ url_for('routes.add_recommendation', cert_id=certification.id) }}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i> Add Recommendation
            </a>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-header">
                <h5 class="card-title mb-0">Recommendations for {{ certification.name }}</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <p class="mb-0"><strong>Authority:</strong> {{ certification.authority }}</p>
                        <p class="mb-0"><strong>Required CPEs:</strong> {{ certification.required_cpes }}</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <p class="mb-0"><strong>Renewal Date:</strong></p>
                        <p class="text-muted">
                            {{ certification.renewal_date.strftime('%B %d, %Y') if certification.renewal_date else 'Not set' }}
                        </p>
                    </div>
                </div>

                <div class="row g-3">
                    {% if recommendations %}
                        {% for rec in recommendations %}
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title">{{ rec.title }}</h6>
                                        <p class="card-text small">{{ rec.description }}</p>
                                        <div class="mb-2">
                                            <small class="text-muted"><strong>Source:</strong> {{ rec.provider }}</small><br>
                                            <small class="text-muted"><strong>Type:</strong> {{ rec.type }}</small><br>
                                            <small class="text-muted"><strong>Expires:</strong> 
                                                {% if rec.expires_at %}
                                                    {{ rec.expires_at }}
                                                {% else %}
                                                    Not set
                                                {% endif %}
                                            </small>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">{{ rec.cpe }} CPEs</small>
                                            <button 
                                                class="btn btn-sm btn-outline-primary"
                                                onclick="logActivity(
                                                    '{{ rec.title|escape }}',
                                                    '{{ rec.description|escape }}',
                                                    '{{ rec.type|escape }}',
                                                    '{{ rec.cpe }}',
                                                    '{{ rec.provider|escape }}',
                                                    '{{ certification.id }}'
                                                )">
                                                Log Activity
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="col-12">
                            <p class="text-muted">No recommendations available.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function logActivity(title, description, type, cpeValue, provider, certId) {
    const url = new URL('{{ url_for("routes.add_activity") }}', window.location.origin);
    url.searchParams.set('prefill_title', title);
    url.searchParams.set('prefill_description', description);
    url.searchParams.set('prefill_type', type);
    url.searchParams.set('prefill_cpe', cpeValue);
    url.searchParams.set('prefill_provider', provider);
    url.searchParams.set('prefill_cert', certId);
    window.location.href = url.toString();
}
</script>
{% endblock %}
